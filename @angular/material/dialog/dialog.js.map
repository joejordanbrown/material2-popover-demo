{"version":3,"sources":["../../../src/lib/dialog/dialog.ts"],"names":[],"mappings":"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","file":"dialog.js","sourcesContent":["import {Injector, ComponentRef, Injectable, Optional, SkipSelf} from '@angular/core';\r\nimport {Observable} from 'rxjs/Observable';\r\nimport {Subject} from 'rxjs/Subject';\r\n\r\nimport {Overlay, OverlayRef, ComponentType, OverlayState, ComponentPortal} from '../core';\r\nimport {extendObject} from '../core/util/object-extend';\r\n\r\nimport {DialogInjector} from './dialog-injector';\r\nimport {MdDialogConfig} from './dialog-config';\r\nimport {MdDialogRef} from './dialog-ref';\r\nimport {MdDialogContainer} from './dialog-container';\r\n\r\n\r\n// TODO(jelbourn): add support for opening with a TemplateRef\r\n// TODO(jelbourn): animations\r\n\r\n\r\n\r\n/**\r\n * Service to open Material Design modal dialogs.\r\n */\r\n@Injectable()\r\nexport class MdDialog {\r\n  private _openDialogsAtThisLevel: MdDialogRef<any>[] = [];\r\n  private _afterAllClosedAtThisLevel = new Subject<void>();\r\n  private _afterOpenAtThisLevel = new Subject<MdDialogRef<any>>();\r\n\r\n  /** Keeps track of the currently-open dialogs. */\r\n  get _openDialogs(): MdDialogRef<any>[] {\r\n    return this._parentDialog ? this._parentDialog._openDialogs : this._openDialogsAtThisLevel;\r\n  }\r\n\r\n  /** Subject for notifying the user that all open dialogs have finished closing. */\r\n  get _afterOpen(): Subject<MdDialogRef<any>> {\r\n    return this._parentDialog ? this._parentDialog._afterOpen : this._afterOpenAtThisLevel;\r\n  }\r\n  /** Subject for notifying the user that a dialog has opened. */\r\n  get _afterAllClosed(): Subject<void> {\r\n    return this._parentDialog ?\r\n      this._parentDialog._afterAllClosed : this._afterAllClosedAtThisLevel;\r\n  }\r\n\r\n  /** Gets an observable that is notified when a dialog has been opened. */\r\n  afterOpen: Observable<MdDialogRef<any>> = this._afterOpen.asObservable();\r\n\r\n  /** Gets an observable that is notified when all open dialog have finished closing. */\r\n  afterAllClosed: Observable<void> = this._afterAllClosed.asObservable();\r\n\r\n  constructor(\r\n      private _overlay: Overlay,\r\n      private _injector: Injector,\r\n      @Optional() @SkipSelf() private _parentDialog: MdDialog) { }\r\n\r\n  /**\r\n   * Opens a modal dialog containing the given component.\r\n   * @param component Type of the component to load into the load.\r\n   * @param config Extra configuration options.\r\n   * @returns Reference to the newly-opened dialog.\r\n   */\r\n  open<T>(component: ComponentType<T>, config?: MdDialogConfig): MdDialogRef<T> {\r\n    config = _applyConfigDefaults(config);\r\n\r\n    let overlayRef = this._createOverlay(config);\r\n    let dialogContainer = this._attachDialogContainer(overlayRef, config);\r\n    let dialogRef = this._attachDialogContent(component, dialogContainer, overlayRef, config);\r\n\r\n    this._openDialogs.push(dialogRef);\r\n    dialogRef.afterClosed().subscribe(() => this._removeOpenDialog(dialogRef));\r\n    this._afterOpen.next(dialogRef);\r\n\r\n    return dialogRef;\r\n  }\r\n\r\n  /**\r\n   * Closes all of the currently-open dialogs.\r\n   */\r\n  closeAll(): void {\r\n    let i = this._openDialogs.length;\r\n\r\n    while (i--) {\r\n      // The `_openDialogs` property isn't updated after close until the rxjs subscription\r\n      // runs on the next microtask, in addition to modifying the array as we're going\r\n      // through it. We loop through all of them and call close without assuming that\r\n      // they'll be removed from the list instantaneously.\r\n      this._openDialogs[i].close();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates the overlay into which the dialog will be loaded.\r\n   * @param dialogConfig The dialog configuration.\r\n   * @returns A promise resolving to the OverlayRef for the created overlay.\r\n   */\r\n  private _createOverlay(dialogConfig: MdDialogConfig): OverlayRef {\r\n    let overlayState = this._getOverlayState(dialogConfig);\r\n    return this._overlay.create(overlayState);\r\n  }\r\n\r\n  /**\r\n   * Attaches an MdDialogContainer to a dialog's already-created overlay.\r\n   * @param overlay Reference to the dialog's underlying overlay.\r\n   * @param config The dialog configuration.\r\n   * @returns A promise resolving to a ComponentRef for the attached container.\r\n   */\r\n  private _attachDialogContainer(overlay: OverlayRef, config: MdDialogConfig): MdDialogContainer {\r\n    let viewContainer = config ? config.viewContainerRef : null;\r\n    let containerPortal = new ComponentPortal(MdDialogContainer, viewContainer);\r\n\r\n    let containerRef: ComponentRef<MdDialogContainer> = overlay.attach(containerPortal);\r\n    containerRef.instance.dialogConfig = config;\r\n\r\n    return containerRef.instance;\r\n  }\r\n\r\n  /**\r\n   * Attaches the user-provided component to the already-created MdDialogContainer.\r\n   * @param component The type of component being loaded into the dialog.\r\n   * @param dialogContainer Reference to the wrapping MdDialogContainer.\r\n   * @param overlayRef Reference to the overlay in which the dialog resides.\r\n   * @param config The dialog configuration.\r\n   * @returns A promise resolving to the MdDialogRef that should be returned to the user.\r\n   */\r\n  private _attachDialogContent<T>(\r\n      component: ComponentType<T>,\r\n      dialogContainer: MdDialogContainer,\r\n      overlayRef: OverlayRef,\r\n      config?: MdDialogConfig): MdDialogRef<T> {\r\n    // Create a reference to the dialog we're creating in order to give the user a handle\r\n    // to modify and close it.\r\n    let dialogRef = <MdDialogRef<T>> new MdDialogRef(overlayRef);\r\n\r\n    if (!dialogContainer.dialogConfig.disableClose) {\r\n      // When the dialog backdrop is clicked, we want to close it.\r\n      overlayRef.backdropClick().first().subscribe(() => dialogRef.close());\r\n    }\r\n\r\n    // Set the dialogRef to the container so that it can use the ref to close the dialog.\r\n    dialogContainer.dialogRef = dialogRef;\r\n\r\n    // We create an injector specifically for the component we're instantiating so that it can\r\n    // inject the MdDialogRef. This allows a component loaded inside of a dialog to close itself\r\n    // and, optionally, to return a value.\r\n    let userInjector = config && config.viewContainerRef && config.viewContainerRef.injector;\r\n    let dialogInjector = new DialogInjector(dialogRef, userInjector || this._injector);\r\n\r\n    let contentPortal = new ComponentPortal(component, null, dialogInjector);\r\n\r\n    let contentRef = dialogContainer.attachComponentPortal(contentPortal);\r\n    dialogRef.componentInstance = contentRef.instance;\r\n\r\n    return dialogRef;\r\n  }\r\n\r\n  /**\r\n   * Creates an overlay state from a dialog config.\r\n   * @param dialogConfig The dialog configuration.\r\n   * @returns The overlay configuration.\r\n   */\r\n  private _getOverlayState(dialogConfig: MdDialogConfig): OverlayState {\r\n    let state = new OverlayState();\r\n    let strategy = this._overlay.position().global();\r\n    let position = dialogConfig.position;\r\n\r\n    state.hasBackdrop = true;\r\n    state.positionStrategy = strategy;\r\n\r\n    if (position && (position.left || position.right)) {\r\n      position.left ? strategy.left(position.left) : strategy.right(position.right);\r\n    } else {\r\n      strategy.centerHorizontally();\r\n    }\r\n\r\n    if (position && (position.top || position.bottom)) {\r\n      position.top ? strategy.top(position.top) : strategy.bottom(position.bottom);\r\n    } else {\r\n      strategy.centerVertically();\r\n    }\r\n\r\n    strategy.width(dialogConfig.width).height(dialogConfig.height);\r\n\r\n    return state;\r\n  }\r\n\r\n  /**\r\n   * Removes a dialog from the array of open dialogs.\r\n   * @param dialogRef Dialog to be removed.\r\n   */\r\n  private _removeOpenDialog(dialogRef: MdDialogRef<any>) {\r\n    let index = this._openDialogs.indexOf(dialogRef);\r\n\r\n    if (index > -1) {\r\n      this._openDialogs.splice(index, 1);\r\n\r\n      // no open dialogs are left, call next on afterAllClosed Subject\r\n      if (!this._openDialogs.length) {\r\n        this._afterAllClosed.next();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Applies default options to the dialog config.\r\n * @param dialogConfig Config to be modified.\r\n * @returns The new configuration object.\r\n */\r\nfunction _applyConfigDefaults(dialogConfig: MdDialogConfig): MdDialogConfig {\r\n  return extendObject(new MdDialogConfig(), dialogConfig);\r\n}\r\n\r\n"]}